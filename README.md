# Документация
## Разворачивание системы
Для разворачивания системы нужны выполнить следующие шаги:  
1. Скопировать файл 'config.env.env' в ту же папку, но новый файл назвать 'congif.env'.  
В этом файле будут находится нужные константы, которые будут полученны внутри кода(process.env).  
Заполнить константы.  
Пример константы:
    ```
    PORT=80
    ```  
    Описание констант:
    - PORT - порт, на котором будет висеть node.js.
    - SECRET_SESSION_KEY - секретный ключ сессии.
    - MONGO_URL - url от MongoDB, с помощью которого будет происходить соединение с базой данных.
    - JWT_SECRET - секретный ключ для JWT.
    - JWT_EXPIRE - время действия JWT. Пример: 5d (5 дней).
    - JWT_COOKIE_EXPIRE - время действия cookie для JWT.  
2. Запустить nginx сервер с конфигом(nginx.conf), перед этим нужно заполнить директивы.  
Пример заполнения директив:
    ```
    proxy_pass http://localhost:8080;
    ```  
    Нужно заполнить следующие директивы: 
    - listen - порт, на котором будет висеть nginx.
    - root - папка с публичными файлами.
    - proxy_pass - адрес, на котором висит node.js.  
3. Установить нужные зависимости для node.js:
   ```
   npm i
   ```  
4. Собрать фронтенд:
   ```
   npm run build
   ```
   Удостовериться, что в /public/dist/index.html атрибут src 2-го тега script ссылается на index.js, находящийся в той же директории.  
5. Запустить node.js:
   ```
   npm run nodemon
   ```  
____  
## Cтруктура проекта
### Структура backend части проекта
Вход в программу осуществляется в файле index.js корневой директории.  
В этом файле разворачивается node.js сервер, подключаются роуты, socket.io, происходит присоединение в MongoDB.  
Иерархия и назначение файлов и папок:
- congif - папка, в ней находятся все конфиги, а так же способ подключения к MongoDB.
    - config.env.env - шаблон конфига, в котором указаны все необходимые константы для приложения.
    - db.js - подключение к MongoDB.
    - passport.js - создание и подключение промежуточного слоя для проверки JWT.
- controllers - папка, в которой находятся контроллеры, которые обрабатывают запросы к API.
    - auth.js - контроллер, связанный с авторизацией и регистрацией пользователей.
    - chats.js - контроллер, связанный с чатами.
    - lessons.js - контроллер, связанный с уроками.
    - students.js - контроллер, связанный с студентами.
- middleware - папка, в которой находятся промежуточные обработчики.
    - validation - промежуточные обработчики, которые проводят валидацию входящих данных.
        - userValidator.js - валидация, связанная с пользователями.
    - auth.js - промежуточный обработчик, который проверяет роль пользователя на доступ.
    - error.handler.js - обработчик ошибок.
- models - папка, в которой находятся модели данных.
    - Chat.js - модель чата.
    - Lesson.js - модель урока.
    - Message.js - модель сообщения.
    - User.js - модель пользователя.
    - Videocall.js - модель видеозвонка.
- routes - папка, в которой находятся роутеры.
    - index.js - входной файл, который инициализирует роутеры, разделённые по категориям.
    - auth.js - роутеры, связанные с пользователями.
    - chats.js - роутеры, связанные с чатами.
    - lessons.js - роутеры, связанные с уроками.
    - students.js - роутеры, связанные с студентами.
- socket - папка, в которой находится логика работы с сокетами.
    - index.js - входной файл, где происходит инициализация сокетов, а так же подключение прослушек, разделённых по категориям.
    - lesson.js - прослушки, связанные с видеозвонками.
    - chat.js - прослушки, связанные с чатами.
- utils - папка, в которой находятся различне утилиты.
    - ErrorResponse.js - класс для работы с ошибками.
- .babelrc - конфиг для babel.
- .gitignore - конфиг для git-а.
- nginx.conf - конфиг для nginx.
- webpack.config.js - конфиг для webpack-а.  
#### Роутеры:
| METHOD | URL | CONTROLLER_FILE | CONTROLLER_METHOD | PROTECT |
|-----|-----------------|-------------------|----|------|
| GET | /api/v1/auth/me | /controllers/auth | me | true |
| GET | /api/v1/auth/logout | /controllers/auth | logout | true |
| POST | /api/v1/auth/login | /controllers/auth | login | false |
| POST | /api/v1/auth/register | /controllers/auth | register | false |
| GET | /api/v1/chats/ | /controllers/chats | getChats | true |
| GET | /:id/messages | /controllers/chats | getMessages | true |
| POST | /api/v1/auth/login | /controllers/chats | createChat | true |
| GET | /api/v1/lessons/ | /controllers/lessons | getLessons | true |
| GET | /api/v1/students/ | /controllers/students | getStudents | true |
____
### Структура frontend части проекта
Вход в программу осуществляется в файле index.js директории /public/src.  
В этом файле создаётся экземпляр Vue, подключается хранилище, роуты, конфиги.  
Иерархия и назначение файлов и папок:
- config.js - конфиг, в котором подключаются сторонние модули для Vue.
- App.vue - первый компонент приложения. В нём проверяется загрузились ли нужная информация для работы приложения, если это так, то начинается встраивание вложенных компонентов
- components - папка, в которой находятся все компоненты приложения.
    - Home.vue - компонент, в котором находятся предыдущие чаты и видеозвонки.
    - Chat.vue - компонент, в котором находится логика работы чата.
    - Menu.vue - компонент, отвечающий за навигацию на сайте.
    - Login.vue - компонент, отвечающий за вход.
    - Register.vue - компонент, отвечающий за регистрацию.
    - Students.vue - компонент, позволяющий учителю взаимодействовать с учениками(вывод списка учеников, поиск учеников, вызов ученика на видеозвонок).
    - Video.vue - компонент, отвечающий за видеозвонки.
- router - папка, в которой находятся роуты.
    - index.js - роуты
- store - папка, в которой находятся хранилища (vuex).
    - index.js - вход в хранилище.
    - auth.js - работа с пользователями(авторизация, регистрация, проверка на пользователя, хранение jwt). Библиотека: vue-auth.
    - socket.js - проверка сокетов на готовность.  
#### Библиотеки:
- vuex - хранилище.
- vue-axios - axios для vue.
- vue-router - роутинг для vue.
- vue-socket.io - socket.io для vue.
- vuex-router-sync - синхронизация vuex с vue-router.
#### Роутеры:
| PATH | NAME | COMPONENT | AUTH | REDIRECT_NAME |
|------|------|-----------|------|---------------|
| /login | Login | Login | false | Home |
| /register | Register | Register | false | Home |
| /video/:id | Video | Video | true | Login |
| /chat/:id | Chat | Chat | true | Login |
| /students | Students | Students | [ 'teacher' ] | Home |
| / | Home | Home | true | Login |
| * | - | - | - | Home |